class Calendar{today={};current_date={};diaries={};static formatDate(e){return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),day:e.getDay()}}static getMonthDays(e){const t=Calendar.formatDate(e),n={1:31,2:t.year%4?28:29,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};return{dayCount:n[t.month],firstDay:(7-(t.date-t.day+6)%7)%7}}static getDiaries(e){var t;return $.ajax({url:e,async:!1,dataType:"json",success:function(e){t=e}}),t}fillCalendar(e){const t=Calendar.formatDate(e),a=Calendar.formatDate(this.today),o=Calendar.getMonthDays(e);this.diaries[String(t.year)]?(n=this.diaries[String(t.year)][t.month>=10?String(t.month):"0"+String(t.month)],n=n||{}):n={},console.log(String(t.year),t.month>=10?String(t.month):"0"+String(t.month)),console.log(this.diaries[String(t.year)][t.month>=10?String(t.month):"0"+String(t.month)]),document.getElementById("calendar-year").value=t.year,document.getElementById("calendar-month").value=t.month;const r=document.querySelector(".calendar-days");var n,s="";const i=t.month<10?"0"+t.month:t.month;if(t.year==a.year&&t.month==a.month)for(let e=1;e<=o.dayCount;e++){const a=e<10?"0"+e:e;e==t.date?s+=`<span class="today">${n[e]?'<a href="/diary/'+t.year+"/"+i+"/"+a+'">':""}${a}${n[e]?"</a>":""}</span>`:s+=`<span>${n[e]?'<a href="/diary/'+t.year+"/"+i+"/"+a+'">':""}${a}${n[e]?"</a>":""}</span>`}else for(let e=1;e<=o.dayCount;e++){const a=e<10?"0"+e:e;s+=`<span>${n[e]?'<a href="/diary/'+t.year+"/"+i+"/"+a+'">':""}${a}${n[e]?"</a>":""}</span>`}r.innerHTML='<span class="empty"></span>'.repeat(o.firstDay)+s,window.pjax.refresh(document.getElementById("Calendar"))}constructor(){this.today=new Date,this.current_date=new Date,this.current_date.setDate(1),this.diaries=Calendar.getDiaries("/data/diaries.json");function e(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()}document.querySelector(".calendar-year-month").innerHTML=`<input type="text" id="calendar-year" placeholder="${this.today.getFullYear()}"/>年<input type="text" id="calendar-month" placeholder="${this.today.getMonth()+1}"/>月`,document.getElementById("calendar-year").value=this.today.getFullYear(),document.getElementById("calendar-month").value=this.today.getMonth()+1,this.fillCalendar(this.today);const t=document.getElementById("calendar-year"),n=document.getElementById("calendar-month"),s=s=>{if(s.code=="Enter"){var o=t.value?t.value:this.today.getFullYear(),i=n.value?n.value:this.today.getMonth()+1;this.current_date.setMonth(i-1),this.current_date.setYear(o),e(this.current_date,this.today)?this.fillCalendar(this.today):this.fillCalendar(this.current_date)}};t.onkeydown=s,n.onkeydown=s,document.querySelector(".calendar-header-prev").innerHTML=`<button id="calendar-year-prev"><i class="fa-solid fa-angles-left"></i></button>
<button id="calendar-month-prev"><i class="fa-solid fa-chevron-left"></i></button>`,document.querySelector(".calendar-header-next").innerHTML=`<button id="calendar-month-next"><i class="fa-solid fa-chevron-right"></i></button>
<button id="calendar-year-next"><i class="fa-solid fa-angles-right"></i></button>`,document.getElementById("calendar-year-prev").onclick=()=>{this.current_date.setYear(this.current_date.getFullYear()-1),e(this.current_date,this.today)?this.fillCalendar(this.today):this.fillCalendar(this.current_date)},document.getElementById("calendar-year-next").onclick=()=>{this.current_date.setYear(this.current_date.getFullYear()+1),e(this.current_date,this.today)?this.fillCalendar(this.today):this.fillCalendar(this.current_date)},document.getElementById("calendar-month-prev").onclick=()=>{this.current_date.setMonth(this.current_date.getMonth()-1),e(this.current_date,this.today)?this.fillCalendar(this.today):this.fillCalendar(this.current_date)},document.getElementById("calendar-month-next").onclick=()=>{this.current_date.setMonth(this.current_date.getMonth()+1),e(this.current_date,this.today)?this.fillCalendar(this.today):this.fillCalendar(this.current_date)}}}document.addEventListener("DOMContentLoaded",function(){new Calendar})