<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,height=device-height,initial-scale=1"><meta property="og:site_name" content="Aloha's Blog"><meta property="og:title" content="R 数据科学"><meta property="og:description" content="R for Data Science 中译本《R 数据科学》的读书笔记。"><meta property="og:locale" content="zh_CN"><meta property="og:url" content="https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/"><meta property="og:image" content="https://daisilia.wiki/images/favicon.ico"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-09-02 19:12:20 +0800 +0800"><meta property="article:modified_time" content="2022-05-09 14:26:16 +0800 +0800"><meta property="article:expiration_time" content="0001-01-01 00:00:00 +0000 UTC"><meta property="article:author" content="Qihuan Liu"><meta property="article:tag" content="R 数学建模 数据分析 "><meta property="article:section" content><title>R 数据科学 | Aloha's Blog</title><link rel=stylesheet href=/css/bundle.min.32845bbb1b0f37b3bef7c4e3eaab8557974d887dd7f851a5903034e3093f0538.css integrity="sha256-MoRbuxsPN7O+98Tj6quFV5dNiH3X+FGlkDA04wk/BTg="><link href=https://cdn.bootcdn.net/ajax/libs/font-awesome/6.1.1/css/all.min.css rel=stylesheet><link href=https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css rel=stylesheet><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Andada+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Indie+Flower&family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+SC:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel="shortcut icon" href=/images/favicon.ico type=image/vnd.microsoft.icon><link rel=icon href=/images/favicon.ico type=image/vnd.microsoft.icon></head><body class=site-root id=SiteRoot><div id=preload-mask><div class=lds-default><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div class=site-inner id=SiteInner><header class=site-header id=SiteHeader><h1 class=site-title>Aloha's Blog</h1><ul class=main-menu><li class=menu-item><a href=/><i class="fas fa-home"></i>Home</a></li><li class=menu-item><a href=/about/><i class="fas fa-user"></i>About</a></li><li class=menu-item><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li><li class=menu-item><a href=/series/><i class="fas fa-book"></i>Series</a></li><li class="menu-item search" id=searchBtn><i class="fas fa-search"></i>CTRL-/</li></ul></header><div class=site-main id=SiteMain><div class=site-left data-pjax></div><div class=site-message-list></div><div class=site-content data-pjax id=SiteContent><h1 class="article-title single-title">R 数据科学</h1><div class=article-metadata><ul class=meta-section><li class=meta-item><i class="fas fa-calendar"></i>
<span class=meta-item-text>Posted on</span>
<span class=meta-item-value>2021-09-02</span></li><li class=meta-item><i class="fas fa-clock"></i>
<span class=meta-item-text>Edited on</span>
<span class=meta-item-value>2022-05-09</span></li></ul><ul class=meta-section><li class=meta-item><i class="fas fa-tags"></i>
<span class=meta-item-text>Tags:</span>
<span class=meta-item-value><a class=tag href=/tags/r>R</a>, <a class=tag href=/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1>数学建模</a>, <a class=tag href=/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90>数据分析</a></span></li><li class=meta-item><i class="fas fa-folder-open"></i>
<span class=meta-item-text>In</span>
<a class=meta-item-value href=/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/>R 与数学建模</a></li></ul><ul class=meta-section><li class=meta-item><i class="far fa-file-word"></i>
<span class=meta-item-text>Word count ≈</span>
<span class=meta-item-value>2300</span></li><li class=meta-item><i class="fas fa-hourglass-start"></i>
<span class=meta-item-text>Reading time ≈</span>
<span class=meta-item-value>5 min</span></li></ul></div><div class='cross-refs top'><a class=cross-ref href=/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E8%AF%AD%E8%A8%80/>R-语言</a></div><div class=article-content><p><a href=https://r4ds.had.co.nz/ target=_blank><em>R for Data Science</em></a> 中译本《R 数据科学》的读书笔记。</p><p><code>tidyverse</code> 是一个非常优秀的包，<em>R for Data Science</em> 需要安装该包：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>install.packages</span><span style=color:#111>(</span><span style=color:#d88200>&#34;tidyverse&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>library()</code> 以 加载 R 包：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>tidyverse</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; Error in library(tidyverse): 不存在叫&#39;tidyverse&#39;这个名字的程辑包
</span></span></code></pre></td></tr></table></div></div><h2 class=heading id=使用-ggplot2-进行数据可视化><a href=#%e4%bd%bf%e7%94%a8-ggplot2-%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e5%8f%af%e8%a7%86%e5%8c%96>使用 ggplot2 进行数据可视化</a></h2><h3 class=heading id=准备><a href=#%e5%87%86%e5%a4%87>准备</a></h3><p>你可以使用 ggplot2 中的 <code>mpg</code> 数据框（即 <code>ggplot2::mpg</code>）用于练习。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>ggplot2</span><span style=color:#f92672>::</span><span style=color:#111>mpg</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; # A tibble: 234 × 11
</span></span><span style=display:flex><span>#&gt;    manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class
</span></span><span style=display:flex><span>#&gt;    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
</span></span><span style=display:flex><span>#&gt;  1 audi         a4           1.8  1999     4 auto… f        18    29 p     comp…
</span></span><span style=display:flex><span>#&gt;  2 audi         a4           1.8  1999     4 manu… f        21    29 p     comp…
</span></span><span style=display:flex><span>#&gt;  3 audi         a4           2    2008     4 manu… f        20    31 p     comp…
</span></span><span style=display:flex><span>#&gt;  4 audi         a4           2    2008     4 auto… f        21    30 p     comp…
</span></span><span style=display:flex><span>#&gt;  5 audi         a4           2.8  1999     6 auto… f        16    26 p     comp…
</span></span><span style=display:flex><span>#&gt;  6 audi         a4           2.8  1999     6 manu… f        18    26 p     comp…
</span></span><span style=display:flex><span>#&gt;  7 audi         a4           3.1  2008     6 auto… f        18    27 p     comp…
</span></span><span style=display:flex><span>#&gt;  8 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…
</span></span><span style=display:flex><span>#&gt;  9 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…
</span></span><span style=display:flex><span>#&gt; 10 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…
</span></span><span style=display:flex><span>#&gt; # … with 224 more rows
</span></span></code></pre></td></tr></table></div></div><p><strong>数据框</strong>是变量（列）和观测（行）的矩形集合。<code>mpg</code> 包含了由美国环境保护协会收集的 38 种车型的观测数据。</p><ul><li><code>displ</code>：引擎大小，单位为升</li><li><code>hwy</code>：燃油效率，单位为英里/加仑（mpg）</li></ul><h3 class=heading id=绘制-ggplot-图形><a href=#%e7%bb%98%e5%88%b6-ggplot-%e5%9b%be%e5%bd%a2>绘制 ggplot 图形</a></h3><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/ggplot2-introduction-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/ggplot2-introduction-1.png></a></figure><p><code>ggplot(data = mpg)</code> 创建了一个空白的坐标系，<code>geom_point()</code> 就向图中添加了一个点层，这样就创建了一个散点图。</p><p><code>ggplot2</code> 中每个几何对象都有一个 <code>mapping</code> 参数。这个参数定义了如何将数据集中的变量映射为图形属性。<code>mapping</code> 参数总是与 <code>aes()</code> 函数成对出现，<code>aes()</code> 函数的 <code>x</code> 参数和 <code>y</code> 参数分别指定了映射到 <code>x</code> 轴的变量与映射到 <code>y</code> 轴的变量。<code>ggplot2</code> 在 <code>data</code> 参数中寻找映射变量，本例中就是 <code>mpg</code>。</p><p>总结来说，要生成一张图，使用以下代码模版即可：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#f92672>&lt;</span><span style=color:#111>DATA</span><span style=color:#f92672>&gt;</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;</span><span style=color:#111>GEOM_FUNCTIOM</span><span style=color:#f92672>&gt;</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#f92672>&lt;</span><span style=color:#111>MAPPINGS</span><span style=color:#f92672>&gt;</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 class=heading id=图片属性映射><a href=#%e5%9b%be%e7%89%87%e5%b1%9e%e6%80%a7%e6%98%a0%e5%b0%84>图片属性映射</a></h3><p>可以将数据集中的第三个变量，如 <code>class</code>，映射为二维散点图中的<strong>图形属性</strong>，如数据点的大小、形状和颜色。</p><p>将 <code>class</code> 映射为 <code>color</code>（或 <code>colour</code>），可以清晰地在图中辨别车辆的类型：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#111>class</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-color-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-color-1.png></a></figure><p>用 <code>aes()</code> 将图形属性名称关联起来，<code>ggplot2</code> 就会自动为每个变量值分配唯一的图形属性<em>水平</em>。</p><p>{% note success %}<br>因为已经用“value”表示数据的值，所以使用“level”（水平）来表示图形属性的值。<br>{% endnote %}</p><p>也可以将 <code>class</code> 映射为 <code>size</code> 图形属性：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>size</span> <span style=color:#f92672>=</span> <span style=color:#111>class</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-size-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-size-1.png></a></figure><p>这里出现了一条警告信息，因为将无序变量 <code>class</code> 映射为有需变量 <code>size</code> 不是一个好主意。</p><p>或者将 <code>class</code> 映射为点的透明度或形状：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>alpha</span> <span style=color:#f92672>=</span> <span style=color:#111>class</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>shape</span> <span style=color:#f92672>=</span> <span style=color:#111>class</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><p><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-alpha,shape-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-alpha,shape-1.png></a></figure><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-alpha,shape-2.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/mapping-alpha,shape-2.png></a></figure></p><p>注意下图中的 “suv” 没有显示，这是因为 <code>ggplot2</code> 默认只支持 6 种形状。</p><p>另外，数据点的 x 轴位置 <code>x</code> 和 y 轴位置 <code>y</code> 本身也是图形属性。用数据绘图本质就是将数据中的值映射为图中的图形属性。</p><p>也可以手动为图形属性指定固定水平：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>),</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;blue&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/manual-fixed-value-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/manual-fixed-value-1.png></a></figure><p>注意不要将固定值放在 <code>aes()</code> 函数里，因为此时颜色并不是用来传达变量的信息，而只是改变图的外观。错误示范：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;blue&#34;</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/manual-fixed-value-wrong-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/manual-fixed-value-wrong-1.png></a></figure><p>其中的点的颜色都是橙色，这是因为 R 将 <code>"blue"</code> 视作数据，而不是颜色值。</p><p>此外，需要为图形属性设置一个有效值：</p><ul><li>颜色名称是一个字符串</li><li>点的大小用毫米表示</li><li>点的形状是 0~25 的一个整数值</li></ul><h4 class=heading id=其他示例><a href=#%e5%85%b6%e4%bb%96%e7%a4%ba%e4%be%8b>其他示例</a></h4><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>,</span> <span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>hwy</span><span style=color:#111>))</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>shape</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>21</span><span style=color:#111>,</span> <span style=color:#111>fill</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;white&#34;</span><span style=color:#111>,</span> <span style=color:#111>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span><span style=color:#111>,</span> <span style=color:#111>stroke</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>5</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><p><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/other%20examples-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/other%20examples-1.png></a></figure><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/other%20examples-2.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/other%20examples-2.png></a></figure></p><h3 class=heading id=分面><a href=#%e5%88%86%e9%9d%a2>分面</a></h3><p>要在图中添加新的展示变量，除了可以用图形属性，还可以将图分隔成多个<strong>分面</strong>。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>))</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>facet_wrap</span><span style=color:#111>(</span><span style=color:#f92672>~</span><span style=color:#111>class</span><span style=color:#111>,</span> <span style=color:#111>nrow</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/facet_wrap-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/facet_wrap-1.png></a></figure><p><code>facet_wrap()</code> 函数的第一个参数是一个公式（R 中的一种数据结构，不是数学意义上的公式），传递给 <code>facet_wrap()</code> 的参数应该是离散型的。</p><p>要通过两个变量对图进行分面，需使用 <code>facet_grid()</code> 函数，该函数的公式参数包含由 <code>~</code> 分隔的两个变量名。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>))</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>facet_grid</span><span style=color:#111>(</span><span style=color:#111>drv</span> <span style=color:#f92672>~</span> <span style=color:#111>cyl</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/facet_grid-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/facet_grid-1.png></a></figure><p>如果不想在行或列的维度进行分面，可以使用 <code>.</code> 代替变量名，如 <code>. ~ cyl</code></p><h3 class=heading id=几何对象><a href=#%e5%87%a0%e4%bd%95%e5%af%b9%e8%b1%a1>几何对象</a></h3><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_smooth</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><p><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geometry%20object-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geometry%20object-1.png></a></figure><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geometry%20object-2.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geometry%20object-2.png></a></figure></p><p>两张图使用了同样的数据，但它们使用了不同的可视化对象。在 <code>ggplot2</code> 语法中，我们称它们使用了不同的<strong>几何对象</strong>。第一张图使用了点几何对象而第二张图使用了平滑曲线几何对象。</p><p>你可以在同一张图中使用多个几何对象：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#111>drv</span><span style=color:#111>),</span> <span style=color:#111>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_smooth</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>linetype</span> <span style=color:#f92672>=</span> <span style=color:#111>drv</span><span style=color:#111>,</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#111>drv</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><p id=geom_smooth><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geom_smooth-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geom_smooth-1.png></a></figure></p><p>为避免代码重复，可以将所有几何对象共用的映射写在 <code>ggplot()</code> 函数中，这样 ggplot2 会将这些映射作为全局映射应用到图中的每个几何对象中。以下代码与 <a href=#geom_smooth>上面的代码</a> 等效。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>mpg</span><span style=color:#111>,</span> <span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>displ</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#111>hwy</span><span style=color:#111>,</span> <span style=color:#111>color</span> <span style=color:#f92672>=</span> <span style=color:#111>drv</span><span style=color:#111>))</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_point</span><span style=color:#111>(</span><span style=color:#111>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_smooth</span><span style=color:#111>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 class=heading id=统计变换><a href=#%e7%bb%9f%e8%ae%a1%e5%8f%98%e6%8d%a2>统计变换</a></h3><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>ggplot</span><span style=color:#111>(</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>diamonds</span><span style=color:#111>)</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>geom_bar</span><span style=color:#111>(</span><span style=color:#111>mapping</span> <span style=color:#f92672>=</span> <span style=color:#75af00>aes</span><span style=color:#111>(</span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>cut</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><figure><a data-fancybox data-src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geom_bar-1.png><img src=https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/r-%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6//R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/R-%e6%95%b0%e6%8d%ae%e7%a7%91%e5%ad%a6/geom_bar-1.png></a></figure><p>注意到图中出现了一个新的变量 <code>count</code>，但是 <code>count</code> 不是 <code>diamonds</code> 中的变量。之所以会出现新的变量，是因为一些图形（如条形图）不只是绘制数据集的原始数据，而是可以绘制自己计算出的新数据。</p><ul><li>条形图、直方图和频率多边形图可以对数据进行分组并计算出每组的频数。</li><li>平滑曲线会为数据拟合一个模型，然后绘制出模型预测值。</li><li>……</li></ul><p>绘图时用来计算新数据的算法称为 <code>stat</code>（statistical transformation，<strong>统计变换</strong>）。几何对象（<code>geom_bar</code>）使用给出的值及映射关系（<code>x = cut</code>）计算出新数据（<code>count</code>）及映射（映射到 y 轴）。<br><code>?geom_bar</code> 显示 <code>stat</code>（统计变换）的默认值为 <code>"count"</code>（注意与 <code>stat_count()</code> 计算出的 <code>count</code> 区别），这说明 <code>geom_bar()</code> 默认使用 <code>stat_count()</code> 进行统计变换。<code>stat_count()</code> 的说明也在这页，在 &ldquo;Computed variables&rdquo; 一节中有两个变量 <code>count</code> 和 <code>prop</code>，它们是 <code>stat_count()</code> 会计算出的新数据。</p><p>$${\bf f}<em>{ij} = {\bf r}</em>{ij} / {\bf r}<em>i^{\frac12}\<br>{\bf w} = \frac{\sum\limits</em>{j=1}^k{\bf f}<em>{ij}{\bf p}</em>{ij}}{\sum\limits_{j=1}^k{\bf p}_{ij}},,\ (k=2, i = 1,2,3)<br>\,.$$</p></div><script>typeof MathJax=="undefined"?(window.MathJax={loader:{load:["[tex]/mhchem"],source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},displayMath:[["$$","$$"],["[[","]]"]],packages:{"[+]":["mhchem"]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const o=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],o),s=document.createTextNode("");t.parentNode.replaceChild(s,t),n.start={node:s,delim:"",n:0},n.end={node:s,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;t.nodeName.toLowerCase()==="li"&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script></div><div class=site-comment><script src=https://giscus.app/client.js data-repo=alohaia/alohaia.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNjgxNjY5NTY=" data-category=Announcements data-category-id=DIC_kwDOFfHILM4B_XeA data-mapping=title data-reactions-enabled=1 data-emit-metadata=1 data-theme=light crossorigin=anonymous async></script></div><div class=site-right data-pjax></div></div><div id=fastSearch><div class=fast-search-container><div class=fast-search-header><input id=searchInput autocomplete=off tabindex=0>
<span class=fast-search-hint id=searchHint>CTRL-/</span></div><ul id=searchResults></ul></div></div><script src=/js/fuse.min.js></script>
<script src=/js/fastsearch.js></script><footer class=site-footer id=SiteFooter><div class=footer-powerby><span>Powered by <a target=_blank href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span>Theme - <a target=_blank href=https://github.com/alohaia/hugo-theme-daisilia>Daisilia</a></span></div><div class=footer-copyright>© 2020 - 2022<span class="heart animate__heartBeat animate__infinite"><i class="fas fa-heart"></i></span><span><a target=_blank href=https://daisilia.com>Qihuan Liu</a></span></div><div class=footer-creativecommons>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处。</div></footer><aside class=site-sidebar id=SiteSidebar><div class=sidebar-container><div class=sidebar-nav data-pjax><span role=button class="sidebar-nav-item sidebar-nav-series">Table of Content</span>
<span role=button class="sidebar-nav-item sidebar-nav-overview">Overview</span></div><div class=sidebar-content><div class="sidebar-toc sidebar-pannel" data-pjax><h1 class=toc-title id=TOCTitle>R 数据科学</h1><nav id=TableOfContents><ul><li><a href=#使用-ggplot2-进行数据可视化>使用 ggplot2 进行数据可视化</a><ul><li><a href=#准备>准备</a></li><li><a href=#绘制-ggplot-图形>绘制 ggplot 图形</a></li><li><a href=#图片属性映射>图片属性映射</a><ul><li><a href=#其他示例>其他示例</a></li></ul></li><li><a href=#分面>分面</a></li><li><a href=#几何对象>几何对象</a></li><li><a href=#统计变换>统计变换</a></li></ul></li></ul></nav></div><div class="sidebar-overview sidebar-pannel"><div class=sidebar-avatar><a href=/about><img class=site-avatar-image alt=Aloha src=/images/avatar.gif></a></div><p class=site-author-name>Qihuan Liu</p><p class=site-description>欲望要简单，待人要真诚，扮好每一个角色，与自己和解</p><div class=sidebar-social><a class=sidebar-social-item href=mailto:liu.qihuan@outlook.com><i class="fas fa-envelope"></i>E-Mail</a><a class=sidebar-social-item target=_blank href=https://github.com/alohaia><i class="fab fa-github"></i>Github</a><a class=sidebar-social-item target=_blank href=https://space.bilibili.com/437854288><i class="fa-brands fa-bilibili"></i>Bilibili</a></div><div class=site-state><a class=site-state-item href=/><p class=site-state-num>109</p><p class=site-state-name>Pages</p></a><a class=site-state-item href=/tags><p class=site-state-num>79</p><p class=site-state-name>Tags</p></a><a class=site-state-item href=/series><p class=site-state-num>15</p><p class=site-state-name>Series</p></a></div><div class="sidebar-quote collapsed"><p class=sidebar-quote-content id=SidebarQuoteContent>主人不来过夜半，闲敲棋子落灯花。</p><p class=sidebar-quote-from id=SidebarQuoteFrom>宋代·赵师秀《约客》</p></div><div class=sidebar-music><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js></script>
<meting-js server=netease type=playlist id=6822976600 mini=false fixed=false list-folded=true autoplay volume=0.4 theme=#b7daff order=random loop=all preload=auto mutex=true></meting-js></div><div class=sidebar-links><div class=sidebar-links-title><i class="fas fa-user-friends"></i>友链</div><a class=sidebar-links-item target=_blank href=https://www.sdiopid.top><strong>郭老师</strong>的网络自留地</a></div></div></div><div class=back2top id=Back2top role=button><i class="fas fa-angle-double-up"></i>
<span class=back2top-progress id=Back2topProgress></span></div></div><div class=sidebar-toggle id=SidebarToggle role=button><span class="toggle-line over"></span>
<span class="toggle-line middle"></span>
<span class="toggle-line below"></span></div></aside></div><div class=loading-track><div class=loading-progress></div></div><script src=/js/jquery-3.6.0.min.js></script>
<script src=/js/fancybox.umd.js></script>
<link rel=stylesheet type=text/css href=/css/fancybox.css><script type=module>
  Fancybox.bind("[data-fancybox]", {
    "groupAll": true,
    "hideScrollbar": false, 
  });
</script><script src=/js/daisy.min.58ecd6c7dce63edaec20a66f28422a92308076959543fb2699e3e361265ccc47.js integrity="sha256-WOzWx9zmPtrsIKZvKEIqkjCAdpWVQ/smmePjYSZczEc="></script>
<script data-pjax src=/js/daisy.each.min.ade58891dbe7bb8ca8bd2e1ddb24bb3df37016d49bb3610a79ccbdf816f8a27a.js integrity="sha256-reWIkdvnu4yovS4d2yS7PfNwFtSbs2EKecy9+Bb4ono="></script>
<script src=/js/pjax.min.js></script><script src=/js/pjax.min.915100e431e898add684c6edf0aa9c965e11719a621e1a081492f7231685cdec.js integrity="sha256-kVEA5DHomK3WhMbt8Kqcll4RcZpiHhoIFJL3IxaFzew="></script><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script>
<script>var content_part,content_full,is_poem=!1,Result;const wrap=document.getElementsByClassName("sidebar-quote")[0],content=document.getElementById("SidebarQuoteContent"),from=document.getElementById("SidebarQuoteFrom");function toggleFull(){wrap.classList.toggle("expanded"),wrap.classList.toggle("collapsed"),content.innerHTML==content_part?content.innerHTML=content_full:content.innerHTML=content_part}jinrishici.load(function(e){Result=e,content_part=e.data.content,content.innerText=content_part,from.innerHTML=`<span class="author">${e.data.origin.dynasty}·${e.data.origin.author}</span>`+`<span class="title">《${e.data.origin.title}》</span>`;var t="",n=/^([^，。！？]{5}[，。！？][^，。！？]{5}[，。！？]|[^，。！？]{7}[，。！？][^，。！？]{7}[，。！？])+$/g;e.data.origin.content.join("").match(n)?(content.classList.add("poem"),is_poem=!0):t="&nbsp".repeat(8),content_full=t+e.data.origin.content.join("<br>"+t),content.onclick=toggleFull})</script></body></html>