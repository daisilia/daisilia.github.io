<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,height=device-height,initial-scale=1"><meta property="og:site_name" content="Aloha's Blog"><meta property="og:title" content="植体周炎预测模型：Logistic 回归分析及列线图模型"><meta property="og:description" content="数据准备：使用 sample 函数对原始数据进行随机抽样，抽取 70% 的数据作为训练集（n=329），其余的作为测试集（n=141），抽样结果（训练集）保存在 sample.txt 文件中。
建立模型：使用 stats 程序包中的 glm 函数对训练集数据使用单因素和多因素 Logistic 回归分析，确定发生植体周炎的危险因素（P < 0.05）。用多因素 Logistic 回归分析的结果计算 OR 值，并借助 boot 程序包，使用 Bootstrap 法计算 OR 的 95% 置信区间。使用 rms 程序包建立列线图预测模型。
验证模型：分别借助 rms 程序包中的 calibrate 函数和 pROC 程序包中的 plot.roc 函数，使用 C-index 和校准曲线来检验模型的区分度和校准度。Logistic 回归的 C-index 即为 ROC 曲线下面积（AUC）。内部验证和外部验证分别使用训练集和测试集数据进行。"><meta property="og:locale" content="zh_CN"><meta property="og:url" content="https://daisilia.com/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/%E6%A4%8D%E4%BD%93%E5%91%A8%E7%82%8E%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B/"><meta property="og:image" content="https://daisilia.com/images/favicon.ico"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-02-23 12:55:52 +0800 +0800"><meta property="article:modified_time" content="2023-02-08 18:32:23 +0800 +0800"><meta property="article:expiration_time" content="0001-01-01 00:00:00 +0000 UTC"><meta property="article:author" content="Qihuan Liu"><meta property="article:tag" content="R Logistic 回归分析 列线图预测模型 "><meta property="article:section" content><title>植体周炎预测模型：Logistic 回归分析及列线图模型 | Aloha's Blog</title><link href=/css/root.css rel=stylesheet><link href=/css/sidebar.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/page.css rel=stylesheet><link href=/css/scrollbar.css rel=stylesheet><link href=/css/tags.css rel=stylesheet><link href=/css/fastsearch.css rel=stylesheet><link href=/css/print.css rel=stylesheet><link href=/css/message.css rel=stylesheet><link href=https://cdn.bootcdn.net/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><link href=https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css rel=stylesheet><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Andada+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Indie+Flower&family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+SC:wght@400;600&family=Noto+Serif+SC:wght@600;700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel="shortcut icon" href=/images/favicon.ico type=image/vnd.microsoft.icon><link rel=icon href=/images/favicon.ico type=image/vnd.microsoft.icon><script src=/js/jquery-3.6.0.min.js></script></head><body class=site-root id=SiteRoot><div id=preload-mask><div class=lds-default><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div class=site-inner id=SiteInner><header class=site-header id=SiteHeader><h1 class=site-title>Aloha's Blog</h1><ul class=main-menu><li class=menu-item><a href=/><i class="fas fa-home"></i>Home</a></li><li class=menu-item><a href=/about/><i class="fas fa-user"></i>About</a></li><li class=menu-item><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li><li class=menu-item><a href=/cards/><i style=line-height:15px;vertical-align:middle><svg id="svg10094" width="16.534685" height="15.297463" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs10098"/><sodipodi:namedview id="namedview10096" pagecolor="#ffffff" bordercolor="#999999" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1"/><inkscape:clipboard min="315.37789,349.81892" max="331.91257,365.11639" geom-min="315.37789,349.81892" geom-max="331.91257,365.11638"/><g id="g10100" transform="matrix(3.7795276,0,0,3.7795276,-315.37789,-349.81893)"><rect style="fill:#777;stroke:#333;stroke-width:0;stroke-linejoin:round;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers;stop-color:#000000" id="rect7046-2" width="2.6458323" height="3.174999" x="-87.818535" y="93.428711" ry=".40289268" rx=".3713097" transform="scale(-1,1)"/><rect style="fill:#555;stroke:#333;stroke-width:0;stroke-linejoin:round;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers;stop-color:#000000" id="rect7046-2-0" width="2.6458323" height="3.174999" x="-39.971855" y="119.56335" ry=".40289268" rx=".3713097" transform="matrix(-0.91098326,0.41244333,0.41244333,0.91098326,0,0)"/></g></svg></i>Cards</a></li><li class=menu-item><a href=/series/><i class="fas fa-book"></i>Series</a></li><li class="menu-item search" id=searchBtn><i class="fas fa-search"></i>CTRL-/</li></ul></header><div class=site-main id=SiteMain><div class=site-left data-pjax></div><div class=site-message-list id=MessageList></div><div class=site-content mathjax data-pjax id=SiteContent><h1 class="article-title single-title">植体周炎预测模型：Logistic 回归分析及列线图模型</h1><div class=article-metadata><ul class=meta-section><li class=meta-item><i class="fas fa-upload"></i>
<span class=meta-item-text>Published on</span>
<span class=meta-item-value>2022-02-23</span></li><li class=meta-item><i class="fas fa-file-pen"></i>
<span class=meta-item-text>Modified on</span>
<span class=meta-item-value>2023-02-08</span></li></ul><ul class=meta-section><li class=meta-item><i class="fas fa-tags"></i>
<span class=meta-item-text>Tags:</span>
<span class=meta-item-value><a class=tag href=/tags/r>R</a>, <a class=tag href=/tags/logistic-%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90>Logistic 回归分析</a>, <a class=tag href=/tags/%E5%88%97%E7%BA%BF%E5%9B%BE%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B>列线图预测模型</a></span></li><li class=meta-item><i class="fas fa-folder-open"></i>
<span class=meta-item-text>In</span>
<a class=meta-item-value href=/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/>R 与数学建模</a></li></ul><ul class=meta-section><li class=meta-item><i class="far fa-file-word"></i>
<span class=meta-item-text>Word count ≈</span>
<span class=meta-item-value>4000</span></li><li class=meta-item><i class="fas fa-hourglass-start"></i>
<span class=meta-item-text>Reading time ≈</span>
<span class=meta-item-value>8 min</span></li></ul></div><div class=article-content><p><strong>数据准备</strong>：使用 <code>sample</code> 函数对原始数据进行随机抽样，抽取 70% 的数据作为训练集（n=329），其余的作为测试集（n=141），抽样结果（训练集）保存在 <a href=./sample.txt class=page>sample.txt</a> 文件中。<br><strong>建立模型</strong>：使用 <code>stats</code> 程序包中的 <code>glm</code> 函数对训练集数据使用单因素和多因素 Logistic 回归分析，确定发生植体周炎的危险因素（P &lt; 0.05）。用多因素 Logistic 回归分析的结果计算 OR 值，并借助 <code>boot</code> 程序包，使用 Bootstrap 法计算 OR 的 95% 置信区间。使用 <code>rms</code> 程序包建立列线图预测模型。<br><strong>验证模型</strong>：分别借助 <code>rms</code> 程序包中的 <code>calibrate</code> 函数和 <code>pROC</code> 程序包中的 <code>plot.roc</code> 函数，使用 C-index 和校准曲线来检验模型的区分度和校准度。Logistic 回归的 C-index 即为 ROC 曲线下面积（AUC）。内部验证和外部验证分别使用训练集和测试集数据进行。</p><h2 class=heading id=模型建立><a href=#%e6%a8%a1%e5%9e%8b%e5%bb%ba%e7%ab%8b>模型建立</a></h2><h3 class=heading id=准备工作><a href=#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c>准备工作</a></h3><p>导入需要用到的 R 程序包并导入数据：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75715e># 导入 R 库</span>
</span></span><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>readxl</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>writexl</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>lme4</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>broom</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>tidyverse</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 导入数据</span>
</span></span><span style=display:flex><span><span style=color:#111>raw_data</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>read_excel</span><span style=color:#111>(</span><span style=color:#d88200>&#34;data.xlsx&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><details class="tab default" id=tab_根据需要预处理数据><summary class=tab-sum><span class=tab-sum-content>根据需要预处理数据</span><i class=tab-sum-trigger></i></summary><div class=tab-content><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75715e># 选择研究变量</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span> <span style=color:#f92672>&lt;-</span> <span style=color:#111>raw_data[</span><span style=color:#111>,</span><span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#ae81ff>-1</span><span style=color:#111>,</span><span style=color:#ae81ff>-2</span><span style=color:#111>,</span><span style=color:#ae81ff>-3</span><span style=color:#111>,</span><span style=color:#ae81ff>-10</span><span style=color:#111>,</span><span style=color:#ae81ff>-17</span><span style=color:#111>,</span><span style=color:#ae81ff>-18</span><span style=color:#111>,</span><span style=color:#ae81ff>-20</span><span style=color:#111>)</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#f92672>$</span>年龄 <span style=color:#f92672>&lt;-</span> <span style=color:#111>raw_data</span><span style=color:#f92672>$</span>修复体戴入日期 <span style=color:#f92672>-</span> <span style=color:#111>raw_data</span><span style=color:#f92672>$</span>出生日期
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计数数据</span>
</span></span><span style=display:flex><span><span style=color:#111>names.count</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;吸烟&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;性别&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;修复体材料&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;骨吸收情况&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;分期&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;分级&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                 <span style=color:#d88200>&#34;颌位&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;牙位&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;种植系统&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;植骨手术明细&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;用膜明细&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;缝合方式&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>names.all</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>colnames</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>)</span><span style=color:#111>[</span><span style=color:#f92672>-</span><span style=color:#75af00>which</span><span style=color:#111>(</span><span style=color:#75af00>colnames</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>)</span> <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;植体周炎&#34;</span><span style=color:#111>)</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 再次处理数据细节</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#f92672>$</span>口内植体数目 <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>as.numeric</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>口内植体数目<span style=color:#111>)</span> <span style=color:#75715e># “口内植体数目” 原本是字符串，这里将其转换为数值</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>分级 <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;B&#34;</span><span style=color:#111>),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>分级 <span style=color:#f92672>&lt;-</span> <span style=color:#d88200>&#34;b&#34;</span>         <span style=color:#75715e># 分级 B 和 b 相同</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>分级 <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;a&#34;</span><span style=color:#111>),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>分级 <span style=color:#f92672>&lt;-</span> <span style=color:#d88200>&#34;b&#34;</span>         <span style=color:#75715e># 把分级里a合并到b里面</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>骨吸收情况 <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;1/2&#34;</span><span style=color:#111>),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>骨吸收情况 <span style=color:#f92672>&lt;-</span> <span style=color:#d88200>&#34;&gt;1/2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#75af00>as.numeric</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>修复体材料<span style=color:#111>)</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span><span style=color:#111>),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>修复体材料 <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>3</span> <span style=color:#75715e># 修复体材料 3 以后都合并为一类</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 处理错误数据</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>吸烟 <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span><span style=color:#111>),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>吸烟 <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#75af00>is.na</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>种植系统<span style=color:#111>)),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>种植系统 <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span><span style=color:#75af00>[which</span><span style=color:#111>(</span><span style=color:#75af00>is.na</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#f92672>$</span>用膜明细<span style=color:#111>)),</span><span style=color:#111>]</span><span style=color:#f92672>$</span>用膜明细 <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 去除有缺失值的病例</span>
</span></span><span style=display:flex><span><span style=color:#111>data</span> <span style=color:#f92672>&lt;-</span> <span style=color:#111>data</span><span style=color:#75af00>[complete.cases</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>),</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计数数据转成因子型变量</span>
</span></span><span style=display:flex><span><span style=color:#75af00>for</span><span style=color:#111>(</span><span style=color:#111>name</span> <span style=color:#111>in</span> <span style=color:#111>names.count</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>  <span style=color:#111>data[[name]]</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>factor</span><span style=color:#111>(</span><span style=color:#111>data[[name]]</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></td></tr></table></div></div></div></details><p>现在准备好的数据储存在 <code>data</code> 变量中。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; # A tibble: 6 × 23
</span></span><span style=display:flex><span>#&gt;   吸烟  种植前空腹血糖 性别  修复体材料 口内植体数目 骨吸收情况 分期  分级 
</span></span><span style=display:flex><span>#&gt;   &lt;fct&gt;          &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;             &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt; &lt;fct&gt;
</span></span><span style=display:flex><span>#&gt; 1 0               4.9  1     1                     4 &lt;1/3       3     b    
</span></span><span style=display:flex><span>#&gt; 2 0               4.9  1     1                     4 1/3-1/2    3     b    
</span></span><span style=display:flex><span>#&gt; 3 0               5.98 1     1                     3 &lt;1/3       3     c    
</span></span><span style=display:flex><span>#&gt; 4 0               4.89 2     1                     7 1/3-1/2    3     c    
</span></span><span style=display:flex><span>#&gt; 5 0               4.89 2     1                     7 植体       3     c    
</span></span><span style=display:flex><span>#&gt; 6 0               4.89 2     1                     7 1/3-1/2    4     c    
</span></span><span style=display:flex><span>#&gt; # … with 15 more variables: 颌位 &lt;fct&gt;, 牙位 &lt;fct&gt;, `角化组织宽度（mm）` &lt;dbl&gt;,
</span></span><span style=display:flex><span>#&gt; #   `维护周期（月）` &lt;dbl&gt;, 平均复查周期 &lt;dbl&gt;, 种植系统 &lt;fct&gt;, 植体直径 &lt;dbl&gt;,
</span></span><span style=display:flex><span>#&gt; #   植体长度 &lt;dbl&gt;, 植骨手术明细 &lt;fct&gt;, 用膜明细 &lt;fct&gt;, 缝合方式 &lt;fct&gt;,
</span></span><span style=display:flex><span>#&gt; #   `穿龈角度（近中）` &lt;dbl&gt;, `穿龈角度（远中）` &lt;dbl&gt;, 植体周炎 &lt;dbl&gt;,
</span></span><span style=display:flex><span>#&gt; #   年龄 &lt;drtn&gt;
</span></span></code></pre></td></tr></table></div></div><h3 class=heading id=训练集和测试集><a href=#%e8%ae%ad%e7%bb%83%e9%9b%86%e5%92%8c%e6%b5%8b%e8%af%95%e9%9b%86>训练集和测试集</a></h3><p>通过以下代码随机选取 7/10 的数据作为训练集，并将抽样方案保存在 <a href=./sample.txt class=page>sample.txt</a> 文件中。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>smp</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>sample</span><span style=color:#111>(</span><span style=color:#75af00>seq_len</span><span style=color:#111>(</span><span style=color:#75af00>nrow</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>)),</span> <span style=color:#75af00>round</span><span style=color:#111>(</span><span style=color:#75af00>nrow</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>)</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.7</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#75af00>write</span><span style=color:#111>(</span><span style=color:#111>smp</span><span style=color:#111>,</span> <span style=color:#111>file</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;sample.txt&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><p>代码编写过程中可能需要多次运行代码，为保持多次运行之间的一致性，在选取合适的抽样（<a href=#%e5%8d%95%e5%9b%a0%e7%b4%a0-logistic-%e5%9b%9e%e5%bd%92>单因素 Logistic 回归</a>）后，之后的抽样选取就通过读取 <a href=./sample.txt class=page>sample.txt</a> 文件完成。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75715e># 随机抽取训练集，其他作为测试集</span>
</span></span><span style=display:flex><span><span style=color:#111>smp</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>scan</span><span style=color:#111>(</span><span style=color:#111>file</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;sample.txt&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>data.train</span> <span style=color:#f92672>&lt;-</span> <span style=color:#111>data[smp</span><span style=color:#111>,</span> <span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#111>data.test</span> <span style=color:#f92672>&lt;-</span> <span style=color:#111>data[</span><span style=color:#f92672>-</span><span style=color:#111>smp</span><span style=color:#111>,</span> <span style=color:#111>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 class=heading id=单因素-logistic-回归><a href=#%e5%8d%95%e5%9b%a0%e7%b4%a0-logistic-%e5%9b%9e%e5%bd%92>单因素 Logistic 回归</a></h3><p>使用 <code>glm</code> 函数，对训练集数据的每个预测变量进行单因素分析，获取 P 值，并选出 P &lt; 0.05 的预测变量（抽样的不同会对这一步造成较大影响）。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>p.values</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>data.frame</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>names.selected</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>c</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#75af00>for </span><span style=color:#111>(</span><span style=color:#111>name</span> <span style=color:#111>in</span> <span style=color:#111>names.all</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>  <span style=color:#111>f</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>as.formula</span><span style=color:#111>(</span><span style=color:#75af00>paste</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;植体周炎&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>paste</span><span style=color:#111>(</span><span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;`&#34;</span><span style=color:#111>,</span> <span style=color:#111>name</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;`&#34;</span><span style=color:#111>),</span> <span style=color:#111>collapse</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;&#34;</span><span style=color:#111>)),</span> <span style=color:#111>collapse</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;~&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>  <span style=color:#111>model.tmp</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>glm</span><span style=color:#111>(</span><span style=color:#111>f</span><span style=color:#111>,</span> <span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>data.train</span><span style=color:#111>,</span> <span style=color:#111>family</span> <span style=color:#f92672>=</span> <span style=color:#75af00>binomial</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>  <span style=color:#111>additions</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>summary</span><span style=color:#111>(</span><span style=color:#111>model.tmp</span><span style=color:#111>)</span><span style=color:#f92672>$</span><span style=color:#111>coefficients[</span><span style=color:#ae81ff>-1</span><span style=color:#111>,</span> <span style=color:#ae81ff>4</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span>  <span style=color:#75af00>if </span><span style=color:#111>(</span><span style=color:#75af00>is.null</span><span style=color:#111>(</span><span style=color:#75af00>names</span><span style=color:#111>(</span><span style=color:#111>additions</span><span style=color:#111>)))</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>names</span><span style=color:#111>(</span><span style=color:#111>additions</span><span style=color:#111>)</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>paste</span><span style=color:#111>(</span><span style=color:#111>name</span><span style=color:#111>,</span> <span style=color:#75af00>levels</span><span style=color:#111>(</span><span style=color:#111>data.train[[name]]</span><span style=color:#111>)</span><span style=color:#111>[</span><span style=color:#ae81ff>-1</span><span style=color:#111>]</span><span style=color:#111>,</span> <span style=color:#111>sep</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#111>p.values</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>rbind</span><span style=color:#111>(</span><span style=color:#111>p.values</span><span style=color:#111>,</span> <span style=color:#75af00>data.frame</span><span style=color:#111>(</span><span style=color:#d88200>&#34;P value&#34;</span> <span style=color:#f92672>=</span> <span style=color:#111>additions</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>  <span style=color:#75af00>if </span><span style=color:#111>(</span><span style=color:#75af00>any</span><span style=color:#111>(</span><span style=color:#111>additions</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.05</span><span style=color:#111>))</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#111>names.selected</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#111>names.selected</span><span style=color:#111>,</span> <span style=color:#111>name</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>names.selected</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; [1] &#34;修复体材料&#34;     &#34;骨吸收情况&#34;     &#34;分级&#34;           &#34;维护周期（月）&#34;
</span></span><span style=display:flex><span>#&gt; [5] &#34;平均复查周期&#34;
</span></span></code></pre></td></tr></table></div></div><p>根据单因素 Logistic 回归的结果，这次抽样选出的危险因素（P &lt; 0.05）为：“修复体材料”，“骨吸收情况”，“分级”，“维护周期（月）”和“平均复查周期”。</p><h3 class=heading id=多因素-logistic-回归><a href=#%e5%a4%9a%e5%9b%a0%e7%b4%a0-logistic-%e5%9b%9e%e5%bd%92>多因素 Logistic 回归</a></h3><p>用单因素 Logistic 回归筛选出的危险因素，同样使用 <code>glm</code> 函数，进行多因素 Logistic 回归分析。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>names.05</span> <span style=color:#f92672>&lt;-</span> <span style=color:#111>names.selected</span>
</span></span><span style=display:flex><span><span style=color:#111>f.05</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>as.formula</span><span style=color:#111>(</span><span style=color:#75af00>paste</span><span style=color:#111>(</span><span style=color:#111>collapse</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;~&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>   <span style=color:#75af00>c</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>     <span style=color:#d88200>&#34;植体周炎&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#75af00>paste</span><span style=color:#111>(</span><span style=color:#111>collapse</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;`&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>paste</span><span style=color:#111>(</span><span style=color:#111>names.05</span><span style=color:#111>,</span> <span style=color:#111>collapse</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;`+`&#34;</span><span style=color:#111>),</span> <span style=color:#d88200>&#34;`&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>     <span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>model.05</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>glm</span><span style=color:#111>(</span><span style=color:#111>f.05</span><span style=color:#111>,</span> <span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>data.train</span><span style=color:#111>,</span> <span style=color:#111>family</span> <span style=color:#f92672>=</span> <span style=color:#75af00>binomial</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span><span style=color:#75af00>summary</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; 
</span></span><span style=display:flex><span>#&gt; Call:
</span></span><span style=display:flex><span>#&gt; glm(formula = f.05, family = binomial(), data = data.train)
</span></span><span style=display:flex><span>#&gt; 
</span></span><span style=display:flex><span>#&gt; Deviance Residuals: 
</span></span><span style=display:flex><span>#&gt;    Min      1Q  Median      3Q     Max  
</span></span><span style=display:flex><span>#&gt; -1.511  -0.548  -0.331  -0.189   2.628  
</span></span><span style=display:flex><span>#&gt; 
</span></span><span style=display:flex><span>#&gt; Coefficients:
</span></span><span style=display:flex><span>#&gt;                   Estimate Std. Error z value Pr(&gt;|z|)    
</span></span><span style=display:flex><span>#&gt; (Intercept)       -5.26989    0.72909   -7.23  4.9e-13 ***
</span></span><span style=display:flex><span>#&gt; 修复体材料2       -0.07740    0.41125   -0.19  0.85072    
</span></span><span style=display:flex><span>#&gt; 修复体材料3        0.95364    0.52022    1.83  0.06678 .  
</span></span><span style=display:flex><span>#&gt; 骨吸收情况&gt;1/2     2.81191    0.63639    4.42  9.9e-06 ***
</span></span><span style=display:flex><span>#&gt; 骨吸收情况1/3-1/2  0.66028    0.44389    1.49  0.13689    
</span></span><span style=display:flex><span>#&gt; 骨吸收情况植体     1.12159    0.52408    2.14  0.03235 *  
</span></span><span style=display:flex><span>#&gt; 分级c              1.08745    0.44902    2.42  0.01544 *  
</span></span><span style=display:flex><span>#&gt; `维护周期（月）`   0.02031    0.00576    3.52  0.00042 ***
</span></span><span style=display:flex><span>#&gt; 平均复查周期       0.01974    0.00941    2.10  0.03593 *  
</span></span><span style=display:flex><span>#&gt; ---
</span></span><span style=display:flex><span>#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</span></span><span style=display:flex><span>#&gt; 
</span></span><span style=display:flex><span>#&gt; (Dispersion parameter for binomial family taken to be 1)
</span></span><span style=display:flex><span>#&gt; 
</span></span><span style=display:flex><span>#&gt;     Null deviance: 283.80  on 328  degrees of freedom
</span></span><span style=display:flex><span>#&gt; Residual deviance: 219.58  on 320  degrees of freedom
</span></span><span style=display:flex><span>#&gt; AIC: 237.6
</span></span><span style=display:flex><span>#&gt; 
</span></span><span style=display:flex><span>#&gt; Number of Fisher Scoring iterations: 6
</span></span></code></pre></td></tr></table></div></div><div open class="tab success"><div class=tab-content>注意这里构建公式的方法：先使用加了 <code>collapse</code> 参数的 <code>paste</code> 函数将 <code>names.05</code> 拼接成字符串形式的“公式”，再通过 <code>as.formula</code> 方法，将字符串转换为公式。</div></div><h3 class=heading id=or-及-or-的-95-置信区间><a href=#or-%e5%8f%8a-or-%e7%9a%84-95-%e7%bd%ae%e4%bf%a1%e5%8c%ba%e9%97%b4>OR 及 OR 的 95% 置信区间</a></h3><p>在 R 中，可以使用 <code>exp(coef(model))</code> 计算比值比（OR）。</p><p>既可以借助 <code>boot</code> 程序包，使用 <a href=#bootstrap-%e6%b3%95>Bootstrap 法</a>计算 OR 及其 95% 置信区间，也可以直接使用<a href=#confint-%e5%87%bd%e6%95%b0><code>confint</code> 函数</a>。</p><h4 class=heading id=bootstrap-法><a href=#bootstrap-%e6%b3%95>Bootstrap 法</a></h4><p>为了控制更多的细节，这里使用 <code>boot</code> 程序包的 <code>boot</code> 函数计算 OR，并使用同属于 <code>boot</code> 程序包的 <code>boot.ci</code> 函数计算置信区间。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>boot</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>set.seed</span><span style=color:#111>(</span><span style=color:#ae81ff>1645248416</span><span style=color:#111>)</span> <span style=color:#75715e># unclass(Sys.time())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算 OR 值的函数</span>
</span></span><span style=display:flex><span><span style=color:#111>st.boot</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>function</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>,</span> <span style=color:#111>indices</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>  <span style=color:#111>model</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>glm</span><span style=color:#111>(</span><span style=color:#111>f.05</span><span style=color:#111>,</span> <span style=color:#111>data[indices</span><span style=color:#111>,</span> <span style=color:#111>]</span><span style=color:#111>,</span> <span style=color:#111>family</span> <span style=color:#f92672>=</span> <span style=color:#75af00>binomial</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>  <span style=color:#75af00>return</span><span style=color:#111>(</span><span style=color:#75af00>exp</span><span style=color:#111>(</span><span style=color:#75af00>coef</span><span style=color:#111>(</span><span style=color:#111>model</span><span style=color:#111>)))</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 运行 Bootstrap 计算 OR</span>
</span></span><span style=display:flex><span><span style=color:#111>results</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>boot</span><span style=color:#111>(</span><span style=color:#111>data.train</span><span style=color:#111>,</span> <span style=color:#111>statistic</span> <span style=color:#f92672>=</span> <span style=color:#111>st.boot</span><span style=color:#111>,</span> <span style=color:#111>R</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>ci</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>matrix</span><span style=color:#111>(</span><span style=color:#111>nrow</span> <span style=color:#f92672>=</span> <span style=color:#75af00>length</span><span style=color:#111>(</span><span style=color:#111>results</span><span style=color:#f92672>$</span><span style=color:#111>t0</span><span style=color:#111>),</span> <span style=color:#111>ncol</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>colnames</span><span style=color:#111>(</span><span style=color:#111>ci</span><span style=color:#111>)</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;2.5%&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;97.5%&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>rownames</span><span style=color:#111>(</span><span style=color:#111>ci</span><span style=color:#111>)</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>names</span><span style=color:#111>(</span><span style=color:#111>results</span><span style=color:#f92672>$</span><span style=color:#111>t0</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>for </span><span style=color:#111>(</span><span style=color:#111>i</span> <span style=color:#111>in</span> <span style=color:#75af00>seq_len</span><span style=color:#111>(</span><span style=color:#75af00>length</span><span style=color:#111>(</span><span style=color:#111>results</span><span style=color:#f92672>$</span><span style=color:#111>t0</span><span style=color:#111>)))</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>  <span style=color:#111>n</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>boot.ci</span><span style=color:#111>(</span><span style=color:#111>boot.out</span> <span style=color:#f92672>=</span> <span style=color:#111>results</span><span style=color:#111>,</span> <span style=color:#111>conf</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.95</span><span style=color:#111>,</span> <span style=color:#111>type</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;bca&#34;</span><span style=color:#111>,</span> <span style=color:#111>index</span> <span style=color:#f92672>=</span> <span style=color:#111>i</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#111>ci[i</span><span style=color:#111>,</span> <span style=color:#111>]</span> <span style=color:#f92672>&lt;-</span> <span style=color:#111>n</span><span style=color:#f92672>$</span><span style=color:#111>bca</span><span style=color:#75af00>[c</span><span style=color:#111>(</span><span style=color:#ae81ff>4</span><span style=color:#111>,</span> <span style=color:#ae81ff>5</span><span style=color:#111>)</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>table2.05</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>data.frame</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>  <span style=color:#d88200>&#34;OR&#34;</span> <span style=color:#f92672>=</span> <span style=color:#111>results</span><span style=color:#f92672>$</span><span style=color:#111>t0</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>  <span style=color:#d88200>&#34;OR.CI&#34;</span> <span style=color:#f92672>=</span> <span style=color:#111>ci</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>  <span style=color:#d88200>&#34;P值&#34;</span> <span style=color:#f92672>=</span> <span style=color:#75af00>tidy</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>)</span><span style=color:#f92672>$</span><span style=color:#111>p.value</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>head</span><span style=color:#111>(</span><span style=color:#111>table2.05</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt;                          OR OR.CI.2.5. OR.CI.97.5.       P值
</span></span><span style=display:flex><span>#&gt; (Intercept)        0.005144   0.001077     0.02295 4.901e-13
</span></span><span style=display:flex><span>#&gt; 修复体材料2        0.925524   0.365046     2.13859 8.507e-01
</span></span><span style=display:flex><span>#&gt; 修复体材料3        2.595143   0.856581     7.63863 6.678e-02
</span></span><span style=display:flex><span>#&gt; 骨吸收情况&gt;1/2    16.641733   4.311440    62.61887 9.938e-06
</span></span><span style=display:flex><span>#&gt; 骨吸收情况1/3-1/2  1.935325   0.718117     4.88898 1.369e-01
</span></span><span style=display:flex><span>#&gt; 骨吸收情况植体     3.069725   0.762045     8.27774 3.235e-02
</span></span></code></pre></td></tr></table></div></div><h4 class=heading id=confint-函数><a href=#confint-%e5%87%bd%e6%95%b0><code>confint</code> 函数</a></h4><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>table_simple</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>data.frame</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>  <span style=color:#d88200>&#34;OR&#34;</span> <span style=color:#f92672>=</span> <span style=color:#75af00>exp</span><span style=color:#111>(</span><span style=color:#75af00>coef</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>)),</span>
</span></span><span style=display:flex><span>  <span style=color:#d88200>&#34;OR.CI&#34;</span> <span style=color:#f92672>=</span> <span style=color:#75af00>exp</span><span style=color:#111>(</span><span style=color:#75af00>confint</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>)),</span>
</span></span><span style=display:flex><span>  <span style=color:#d88200>&#34;P值&#34;</span> <span style=color:#f92672>=</span> <span style=color:#75af00>tidy</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>)</span><span style=color:#f92672>$</span><span style=color:#111>p.value</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>head</span><span style=color:#111>(</span><span style=color:#111>table_simple</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt;                          OR OR.CI.2.5.. OR.CI.97.5..       P值
</span></span><span style=display:flex><span>#&gt; (Intercept)        0.005144    0.001112      0.01965 4.901e-13
</span></span><span style=display:flex><span>#&gt; 修复体材料2        0.925524    0.403301      2.04682 8.507e-01
</span></span><span style=display:flex><span>#&gt; 修复体材料3        2.595143    0.913069      7.12754 6.678e-02
</span></span><span style=display:flex><span>#&gt; 骨吸收情况&gt;1/2    16.641733    4.901419     60.79632 9.938e-06
</span></span><span style=display:flex><span>#&gt; 骨吸收情况1/3-1/2  1.935325    0.811607      4.67088 1.369e-01
</span></span><span style=display:flex><span>#&gt; 骨吸收情况植体     3.069725    1.063397      8.47141 3.235e-02
</span></span></code></pre></td></tr></table></div></div><p>OR 和 P 值与之前的结果相同，但置信区间有少许差别。</p><h2 class=heading id=列线图预测模型><a href=#%e5%88%97%e7%ba%bf%e5%9b%be%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b>列线图预测模型</a></h2><p><code>rms</code> 程序包提供了用来建立列线图预测模型的函数。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>rms</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用训练集建立列线图预测模型</span>
</span></span><span style=display:flex><span><span style=color:#111>fit.train</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>lrm</span><span style=color:#111>(</span><span style=color:#111>f.05</span><span style=color:#111>,</span> <span style=color:#111>data.train</span><span style=color:#111>,</span> <span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>ddist.train</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>datadist</span><span style=color:#111>(</span><span style=color:#111>data.train</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>options</span><span style=color:#111>(</span><span style=color:#111>datadist</span> <span style=color:#f92672>=</span> <span style=color:#111>ddist.train</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>plot</span><span style=color:#111>(</span><span style=color:#75af00>nomogram</span><span style=color:#111>(</span><span style=color:#111>fit.train</span><span style=color:#111>,</span> <span style=color:#111>fun</span> <span style=color:#f92672>=</span> <span style=color:#111>plogis</span><span style=color:#111>,</span> <span style=color:#111>lp</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>FALSE</span><span style=color:#111>,</span> <span style=color:#111>funlabel</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;预测概率&#34;</span><span style=color:#111>))</span>
</span></span></code></pre></td></tr></table></div></div><figure><img src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-9-1.png data-fancybox data-src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-9-1.png alt=列线图预测模型><figcaption><h4 class=title>列线图预测模型</h4></figcaption></figure><h2 class=heading id=数据验证><a href=#%e6%95%b0%e6%8d%ae%e9%aa%8c%e8%af%81>数据验证</a></h2><p>数据验证分为内部验证和外部验证。这里使用测试集进行外部验证，内部验证在训练集上进行。在内部验证和外部验证中，都分别通过 <a href=#roc-%e6%9b%b2%e7%ba%bf>ROC 曲线</a>和<a href=#%e5%88%97%e7%ba%bf%e5%9b%be%e6%a0%a1%e5%87%86%e6%9b%b2%e7%ba%bf>列线图校准曲线</a>检验数据的区分度和校准度。</p><h3 class=heading id=roc-曲线><a href=#roc-%e6%9b%b2%e7%ba%bf>ROC 曲线</a></h3><figure class=float-right id=fig_Sensitivity_and_specificity.svg><img src=/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/%E6%A4%8D%E4%BD%93%E5%91%A8%E7%82%8E%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B/Sensitivity_and_specificity.svg data-fancybox data-src=/r-%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/%E6%A4%8D%E4%BD%93%E5%91%A8%E7%82%8E%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B/Sensitivity_and_specificity.svg alt=Sensitivity_and_specificity.svg><figcaption><h4 class=title>特异度和敏感度</h4><p class=caption></p><p class="attribution fig-attribution">由FeanDoe - Modified version from Walber's Precision and Recall &lt;a class="external free" href="https://commons.wikimedia.org/wiki/File:Precisionrecall.svg">https://commons.wikimedia.org/wiki/File:Precisionrecall.svg&lt;/a>，<a href=https://creativecommons.org/licenses/by-sa/4.0 title='Creative Commons Attribution-Share Alike 4.0'>CC BY-SA 4.0</a>，<a href='https://commons.wikimedia.org/w/index.php?curid=65826093'>链接</a></p></figcaption></figure><p>ROC 曲线<strong>全称受试者工作特征曲线</strong> （receiver operating characteristic curve），又称为<strong>感受性曲线</strong>（sensitivity curve），曲线上每个点反映着对同一信号刺激的感受性。<br>ROC 曲线的横轴为<strong>特异度</strong>（specificity），即<strong>真阴性率</strong>（true negative rate，TNR）；纵轴为<strong>敏感度</strong>（sensitivity），即<strong>真阳性率</strong>（true postive rate，TPR）、<strong>召回率</strong>（Recall）。</p><p>$$Specificity=TNR=\frac{TN}{N}=\frac{TN}{TN+FP}<br>\,.$$</p><p>$$Sensitivity=TPR=Recall=\frac{TP}{P}=\frac{TP}{TP+FN}<br>\,.$$</p><p>AUC 全称<strong>曲线下面积</strong>（Area Under Curve），在 Logistic 回归中，AUC 等同于 C-index（concordance index，一致性指数），可以直观的评价模型的好坏，值越大越好。</p><p>使用 ROC 曲线检验数据的区分度，<code>pROC</code> 程序包提供了这里所需要的函数，其中 <code>plot.roc</code> 用于绘制 ROC 曲线，<code>ci.auc</code> 用于获取 AUC 的置信区间。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#75af00>library</span><span style=color:#111>(</span><span style=color:#111>pROC</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>pre.train</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>predict</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>,</span> <span style=color:#111>data.train</span><span style=color:#111>,</span> <span style=color:#111>type</span> <span style=color:#f92672>=</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;response&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>p.roc.train</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>plot.roc</span><span style=color:#111>(</span><span style=color:#111>data.train</span><span style=color:#f92672>$</span>植体周炎<span style=color:#111>,</span> <span style=color:#111>pre.train</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>main</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;ROC Curve（训练集）&#34;</span><span style=color:#111>,</span> <span style=color:#111>percent</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>print.auc</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>ci</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span> <span style=color:#111>of</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;thresholds&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>thresholds</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;best&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>print.thres</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;best&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>ci.auc</span><span style=color:#111>(</span><span style=color:#111>p.roc.train</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; 95% CI: 75.2%-88.2% (DeLong)
</span></span></code></pre></td></tr></table></div></div><figure><img src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-11-1.png data-fancybox data-src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-11-1.png alt="ROC Curve（训练集）"><figcaption><h4 class=title>ROC Curve（训练集）</h4></figcaption></figure><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>pre.test</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>predict</span><span style=color:#111>(</span><span style=color:#111>model.05</span><span style=color:#111>,</span> <span style=color:#111>data.test</span><span style=color:#111>,</span> <span style=color:#111>type</span> <span style=color:#f92672>=</span> <span style=color:#75af00>c</span><span style=color:#111>(</span><span style=color:#d88200>&#34;response&#34;</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>p.roc.test</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>plot.roc</span><span style=color:#111>(</span><span style=color:#111>data.test</span><span style=color:#f92672>$</span>植体周炎<span style=color:#111>,</span> <span style=color:#111>pre.test</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>main</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;ROC Curve（测试集）&#34;</span><span style=color:#111>,</span> <span style=color:#111>percent</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>print.auc</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>ci</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span> <span style=color:#111>of</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;thresholds&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>thresholds</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;best&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>                        <span style=color:#111>print.thres</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;best&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>ci.auc</span><span style=color:#111>(</span><span style=color:#111>p.roc.test</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#&gt; 95% CI: 60.2%-79.8% (DeLong)
</span></span></code></pre></td></tr></table></div></div><p><figure><img src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-12-1.png data-fancybox data-src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-12-1.png alt="ROC Curve（测试集）"><figcaption><h4 class=title>ROC Curve（测试集）</h4></figcaption></figure><br>训练集 AUC 达 81.7%（95%CI：75.16%-88.25%），测试集 AUC 为 70.0%（95%CI：60.24%-79.76%），提示列线图模型区分度良好。</p><h3 class=heading id=列线图校准曲线><a href=#%e5%88%97%e7%ba%bf%e5%9b%be%e6%a0%a1%e5%87%86%e6%9b%b2%e7%ba%bf>列线图校准曲线</a></h3><p>使用列线图校准曲线检验数据的校准度。绘制列线图校准曲线用到的 <code>calibrate</code> 也是 <code>rms</code> 包中的函数。这里使用 Bootstrap 法（<code>method = "boot"</code>），重复 1000 次（<code>B = 1000</code>）。其他常用的 <code>method</code> 还有 <code>"crossvalidation"</code>、<code>".632"</code> 及 <code>"randomization"</code>。</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>cal_train</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>calibrate</span><span style=color:#111>(</span><span style=color:#111>fit.train</span><span style=color:#111>,</span>  <span style=color:#111>method</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;boot&#34;</span><span style=color:#111>,</span> <span style=color:#111>B</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>plot</span><span style=color:#111>(</span><span style=color:#111>cal_train</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>xlab</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;Nomogram Predicted&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>ylab</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;Actual&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>main</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;Calibration Curve（训练集）&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><figure><img src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-13-1.png data-fancybox data-src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-13-1.png alt=列线图校准曲线（训练集）><figcaption><h4 class=title>列线图校准曲线（训练集）</h4></figcaption></figure><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#111>fit.test</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>lrm</span><span style=color:#111>(</span><span style=color:#111>f.05</span><span style=color:#111>,</span> <span style=color:#111>data.test</span><span style=color:#111>,</span> <span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>ddist.test</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>datadist</span><span style=color:#111>(</span><span style=color:#111>data.test</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>options</span><span style=color:#111>(</span><span style=color:#111>datadist</span> <span style=color:#f92672>=</span> <span style=color:#111>ddist.test</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>cal_test</span> <span style=color:#f92672>&lt;-</span> <span style=color:#75af00>calibrate</span><span style=color:#111>(</span><span style=color:#111>fit.test</span><span style=color:#111>,</span>  <span style=color:#111>method</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;boot&#34;</span><span style=color:#111>,</span> <span style=color:#111>B</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>plot</span><span style=color:#111>(</span><span style=color:#111>cal_test</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>xlab</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;Nomogram Predicted&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>ylab</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;Actual&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>     <span style=color:#111>main</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;Calibration Curve（测试集）&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></td></tr></table></div></div><figure><img src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-14-1.png data-fancybox data-src=/R-figures/R%20%e4%b8%8e%e6%95%b0%e5%ad%a6%e5%bb%ba%e6%a8%a1/%e6%a4%8d%e4%bd%93%e5%91%a8%e7%82%8e%e9%a2%84%e6%b5%8b%e6%a8%a1%e5%9e%8b/unnamed-chunk-14-1.png alt=列线图校准曲线（测试集）><figcaption><h4 class=title>列线图校准曲线（测试集）</h4></figcaption></figure><p>通过校验曲线可以看出训练集和测试集的预测值与实际值基本一致。</p></div></div><div class=site-comment><script src=https://giscus.app/client.js data-repo=alohaia/alohaia.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNjgxNjY5NTY=" data-category=Announcements data-category-id=DIC_kwDOFfHILM4B_XeA data-mapping=title data-reactions-enabled=1 data-emit-metadata=1 data-theme=light crossorigin=anonymous async></script></div><div class=site-right><div class=series-container><div class=series-toggle><i class="fas fa-book"></i></div><div id=SeriesList class=series-content><p>Enter any child page of <a href=/series/>Series</a>.</p></div></div></div></div><div id=fastSearch><div class=fast-search-container><div class=fast-search-header><input id=searchInput tabindex=-1 disabled autocomplete=off>
<span class=fast-search-hint id=searchHint>CTRL-/</span></div><ul id=searchResults><div id=searchLoading class=lds-default><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></ul></div></div><script src=/js/fuse.min.js></script>
<script src=/js/fastsearch.js></script><footer class=site-footer id=SiteFooter><div class=footer-poweredby><span>Powered by <a href=https://gohugo.io target=_blank>Hugo</a></span>
<span class=division>|</span>
<span>Theme - <a href=https://github.com/alohaia/hugo-theme-daisilia target=_blank>Daisilia</a></span></div><div class=footer-copyright>© 2020 - 2023<span class="heart animate__heartBeat animate__infinite"><i class="fas fa-heart"></i></span>
<span><a href=https://daisilia.com target=_blank>Qihuan Liu</a></span></div><div class=footer-creativecommons>本博客所有文章除特别声明外，均采用 <a rel=license href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处。</div></footer><aside class=site-sidebar id=SiteSidebar><div class=sidebar-container><div class=sidebar-nav data-pjax><span role=button class="sidebar-nav-item sidebar-nav-series">Table of Contents</span>
<span role=button class="sidebar-nav-item sidebar-nav-overview">Overview</span></div><div class=sidebar-content><div class="sidebar-toc sidebar-pannel" data-pjax><h1 class=toc-title id=TOCTitle>植体周炎预测模型：Logistic 回归分析及列线图模型</h1><nav id=TableOfContents><ul><li><a href=#模型建立>模型建立</a><ul><li><a href=#准备工作>准备工作</a></li><li><a href=#训练集和测试集>训练集和测试集</a></li><li><a href=#单因素-logistic-回归>单因素 Logistic 回归</a></li><li><a href=#多因素-logistic-回归>多因素 Logistic 回归</a></li><li><a href=#or-及-or-的-95-置信区间>OR 及 OR 的 95% 置信区间</a><ul><li><a href=#bootstrap-法>Bootstrap 法</a></li><li><a href=#confint-函数><code>confint</code> 函数</a></li></ul></li></ul></li><li><a href=#列线图预测模型>列线图预测模型</a></li><li><a href=#数据验证>数据验证</a><ul><li><a href=#roc-曲线>ROC 曲线</a></li><li><a href=#列线图校准曲线>列线图校准曲线</a></li></ul></li></ul></nav></div><div class="sidebar-overview sidebar-pannel"><div class=sidebar-avatar><a href=/about><img class=site-avatar-image alt=Aloha src=/images/avatar.jpg></a></div><p class=site-author-name>Qihuan Liu</p><p class=site-description>欲望要简单，待人要真诚，扮好每个角色</p><div class=sidebar-social><a class=sidebar-social-item href=mailto:liu.qihuan@outlook.com><i class="fas fa-envelope"></i>E-Mail</a><a class=sidebar-social-item href=https://github.com/alohaia target=_blank><i class="fab fa-github"></i>Github</a><a class=sidebar-social-item href=https://space.bilibili.com/437854288 target=_blank><i class="fa-brands fa-bilibili"></i>Bilibili</a></div><div class=site-overview><a class=site-overview-item href=/><p class=site-overview-num>297</p><p class=site-overview-name>Pages</p></a><a class=site-overview-item href=/tags><p class=site-overview-num>208</p><p class=site-overview-name>Tags</p></a><a class=site-overview-item href=/series><p class=site-overview-num>21</p><p class=site-overview-name>Series</p></a></div><div class="sidebar-quote collapsed"><p class=sidebar-quote-content id=SidebarQuoteContent>主人不来过夜半，闲敲棋子落灯花。</p><p class=sidebar-quote-from id=SidebarQuoteFrom>宋代·赵师秀《约客》</p></div><div class=calendar id=Calendar><div class=calendar-header><div class=calendar-header-prev></div><div class=calendar-year-month></div><div class=calendar-header-next></div></div><div class=calendar-body><div class=calendar-week><span>Sun</span>
<span>Mon</span>
<span>Tue</span>
<span>Wed</span>
<span>Thu</span>
<span>Fri</span>
<span>Sat</span></div><div class=calendar-days></div></div></div><div class=sidebar-links><div class=sidebar-links-title><i class="fas fa-user-friends"></i>友链</div><a class=sidebar-links-item href=https://www.sdiopid.top target=_blank><strong>郭老师</strong>的网络自留地</a></div></div></div><div class=back2top id=Back2top role=button><i class="back2top-icon fas fa-angle-double-up"></i>
<span class=back2top-progress id=Back2topProgress></span></div></div><div class=sidebar-toggle id=SidebarToggle role=button><i class="sidebar-toggle-icon right-arrow">&#xf061</i>
<i class="sidebar-toggle-icon bars">&#xf0c9</i>
<i class="sidebar-toggle-icon left-arrow">&#xf060</i></div><div id=SidebarFill></div></aside></div><div class=loading-track><div class=loading-progress></div></div><script src=/js/fancybox.umd.js></script>
<link rel=stylesheet type=text/css href=/css/fancybox.css><script type=module>
  Fancybox.bind("[data-fancybox]", {
    groupAll: true,
    hideScrollbar: true, 
    caption: function(instance, slide, caption){
      const figcaption = slide.triggerEl?.parentElement.querySelector("figcaption .title");
      return figcaption ? figcaption.innerHTML : slide.caption || "";
    }
  });
</script><script src=/js/daisy.js></script>
<script data-pjax src=/js/daisy.each.js></script>
<script src=/js/pjax.js></script>
<script src=/js/pjax.user.js></script>
<script src=/js/calendar.js></script>
<script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script>
<script>var content_part,content_full,is_poem=!0,Result;const wrap=document.getElementsByClassName("sidebar-quote")[0],content=document.getElementById("SidebarQuoteContent"),from=document.getElementById("SidebarQuoteFrom");function toggleFull(){wrap.classList.toggle("expanded"),wrap.classList.toggle("collapsed"),content.innerHTML==content_part?content.innerHTML=content_full:content.innerHTML=content_part}jinrishici.load(function(e){Result=e,content_part=e.data.content,content.innerText=content_part,from.innerHTML=`<span class="author">${e.data.origin.dynasty}·${e.data.origin.author}</span>`+`<span class="title">《${e.data.origin.title}》</span>`;var t="",n=/^(([^，。！？]{5}[，。！？]){2}|([^，。！？]{7}[，。！？]){2})+$/g,s=0;e.data.origin.content.forEach(e=>{e.match(n)?e.match(n)[0].length+1!=s&&s!=0&&(is_poem=!1,s=e.match(n)[0].length+1):is_poem=!1}),is_poem?content.classList.add("poem"):t="&nbsp".repeat(8),content_full=t+e.data.origin.content.join("<br>"+t),content.onclick=toggleFull})</script></body></html>