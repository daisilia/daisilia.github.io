<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,height=device-height,initial-scale=1"><meta property="og:site_name" content="Aloha's Blog"><meta property="og:title" content="睡眠、休眠与恢复"><meta property="og:description" content="Linux 系统的休眠（Hibernation）与恢复（Resume）可能需要额外的设置才能生效。此外，笔记本上的 Linux 系统从睡眠（Suspend）中恢复后，可能出现键盘（以及触摸板）无法使用的情况。"><meta property="og:locale" content="zh_CN"><meta property="og:url" content="https://daisilia.com/record/linux/%E7%9D%A1%E7%9C%A0%E4%BC%91%E7%9C%A0%E4%B8%8E%E6%81%A2%E5%A4%8D/"><meta property="og:image" content="https://daisilia.com/images/favicon.ico"><meta property="og:type" content="article"><meta property="article:published_time" content="2023-01-19 21:18:38 +0800 +0800"><meta property="article:modified_time" content="2023-01-21 17:19:21 +0800 +0800"><meta property="article:expiration_time" content="0001-01-01 00:00:00 +0000 UTC"><meta property="article:author" content="Qihuan Liu"><meta property="article:tag" content="Linux "><meta property="article:section" content><title>睡眠、休眠与恢复 | Aloha's Blog</title><link href=/css/root.css rel=stylesheet>
<link href=/css/sidebar.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/page.css rel=stylesheet><link href=/css/scrollbar.css rel=stylesheet><link href=/css/tags.css rel=stylesheet><link href=/css/fastsearch.css rel=stylesheet><link href=/css/print.css rel=stylesheet><link href=/css/message.css rel=stylesheet><script src=https://kit.fontawesome.com/6f2d1deb96.js crossorigin=anonymous></script><link href=https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css rel=stylesheet><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Andada+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Indie+Flower&family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+SC:wght@400;600&family=Noto+Serif+SC:wght@600;700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel="shortcut icon" href=/images/favicon.ico type=image/vnd.microsoft.icon><link rel=icon href=/images/favicon.ico type=image/vnd.microsoft.icon><script src=/js/jquery-3.6.0.min.js></script></head><body class=site-root id=SiteRoot><div id=preload-mask><div class=lds-default><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div class=site-inner id=SiteInner><header class=site-header id=SiteHeader><h1 class=site-title>Aloha's Blog</h1><ul class=main-menu><li class=menu-item><a href=/><i class="fas fa-home"></i>Home</a></li><li class=menu-item><a href=/about/><i class="fas fa-user"></i>About</a></li><li class=menu-item><a href=/tags/><i class="fas fa-tags"></i>Tags</a></li><li class=menu-item><a href=/cards/><i style=line-height:15px;vertical-align:middle><svg id="svg10094" width="16.534685" height="15.297463" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs10098"/><sodipodi:namedview id="namedview10096" pagecolor="#ffffff" bordercolor="#999999" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1"/><inkscape:clipboard min="315.37789,349.81892" max="331.91257,365.11639" geom-min="315.37789,349.81892" geom-max="331.91257,365.11638"/><g id="g10100" transform="matrix(3.7795276,0,0,3.7795276,-315.37789,-349.81893)"><rect style="fill:#777;stroke:#333;stroke-width:0;stroke-linejoin:round;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers;stop-color:#000000" id="rect7046-2" width="2.6458323" height="3.174999" x="-87.818535" y="93.428711" ry=".40289268" rx=".3713097" transform="scale(-1,1)"/><rect style="fill:#555;stroke:#333;stroke-width:0;stroke-linejoin:round;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers;stop-color:#000000" id="rect7046-2-0" width="2.6458323" height="3.174999" x="-39.971855" y="119.56335" ry=".40289268" rx=".3713097" transform="matrix(-0.91098326,0.41244333,0.41244333,0.91098326,0,0)"/></g></svg></i>Cards</a></li><li class=menu-item><a href=/series/><i class="fas fa-book"></i>Series</a></li><li class="menu-item search" id=searchBtn><i class="fas fa-search"></i>CTRL-/</li></ul></header><div class=site-main id=SiteMain><div class=site-left data-pjax></div><div class=site-message-list id=MessageList></div><div class=site-content data-pjax id=SiteContent><h1 class="article-title single-title">睡眠、休眠与恢复</h1><div class=article-metadata><ul class=meta-section><li class=meta-item><i class="fas fa-upload"></i>
<span class=meta-item-text>Published on</span>
<span class=meta-item-value>2023-01-19</span></li><li class=meta-item><i class="fas fa-file-pen"></i>
<span class=meta-item-text>Modified on</span>
<span class=meta-item-value>2023-01-21</span></li></ul><ul class=meta-section><li class=meta-item><i class="fas fa-tag"></i>
<span class=meta-item-text>Tag:</span>
<span class=meta-item-value><a class=tag href=/tags/linux>Linux</a></span></li><li class=meta-item><i class="fas fa-folder-open"></i>
<span class=meta-item-text>In</span>
<a class=meta-item-value href=/record/linux/>Linux</a></li></ul><ul class=meta-section><li class=meta-item><i class="far fa-file-word"></i>
<span class=meta-item-text>Word count ≈</span>
<span class=meta-item-value>700</span></li><li class=meta-item><i class="fas fa-hourglass-start"></i>
<span class=meta-item-text>Reading time ≈</span>
<span class=meta-item-value>2 min</span></li></ul></div><div class=article-content><p>Linux 系统的<em>休眠</em>（Hibernation）与<em>恢复</em>（Resume）可能需要额外的设置才能生效。此外，笔记本上的 Linux 系统从<em>睡眠</em>（Suspend）中恢复后，可能出现键盘（以及触摸板）无法使用的情况。</p><p>参考：</p><ul><li><a href=https://forum.manjaro.org/t/not-restoring-after-hibernating/7771 target=_blank rel=external>Not restoring after hibernating - Support - Manjaro Linux Forum</a></li><li><a href=https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#Hibernation target=_blank rel=external>Power management/Suspend and hibernate - ArchWiki</a></li><li><a href=https://wiki.archlinux.org/title/Laptop#Touchpad_not_detected_at_all target=_blank rel=external>Laptop/Touchpad not detected at all - ArchWiki</a></li><li><a href=https://unix.stackexchange.com/questions/28736/what-does-the-i8042-nomux-1-kernel-option-do-during-booting-of-ubuntu target=_blank rel=external>What does the &lsquo;i8042.nomux=1&rsquo; kernel option do during booting of Ubuntu? - StackExchange</a></li></ul><details class="tab info" id=tab_睡眠与休眠><summary class=tab-sum><span class=tab-sum-content>睡眠与休眠</span><i class=tab-sum-trigger></i></summary><div class=tab-content><dl class=indent><dt>Suspend to RAM (aka suspend, aka sleep)</dt><dd>The S3 sleeping state as defined by ACPI. Works by cutting off power to most parts of the machine aside from the RAM, which is required to restore the machine&rsquo;s state. Because of the large power savings, it is advisable for laptops to automatically enter this mode when the computer is running on batteries and the lid is closed (or the user is inactive for some time).</dd><dt>Suspend to disk (aka hibernate)</dt><dd>The S4 sleeping state as defined by ACPI. Saves the machine&rsquo;s state into swap space and completely powers off the machine. When the machine is powered on, the state is restored. Until then, there is zero power consumption.</dd><dt>Suspend to both</dt><dd>A hybrid of the aforementioned methods, sometimes called hybrid suspend. Saves the machine&rsquo;s state into swap space, but does not power off the machine. Instead, it invokes usual suspend to RAM. Therefore, if the battery is not depleted, the system can resume from RAM. If the battery is depleted, the system can be resumed from disk, which is much slower than resuming from RAM, but the machine&rsquo;s state has not been lost.</dd></dl></div></details><h2 class=heading id=配置休眠与恢复><a href=#%e9%85%8d%e7%bd%ae%e4%bc%91%e7%9c%a0%e4%b8%8e%e6%81%a2%e5%a4%8d>配置休眠与恢复</a></h2><h3 class=heading id=配置-initramfs><a href=#%e9%85%8d%e7%bd%ae-initramfs>配置 initramfs</a></h3><p>编辑 <code>/etc/mkinitcpio.conf</code> 文件，添加 <code>resume</code> 钩子（确保在 <code>udev</code> 后面）：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>HOOKS=(base udev autodetect keyboard modconf block filesystems resume fsck)
</span></span></code></pre></td></tr></table></div></div><p>执行以下命令重新生成 <em>initramfs</em>：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo mkinitcpio -P
</span></span></code></pre></td></tr></table></div></div><h3 class=heading id=添加内核参数><a href=#%e6%b7%bb%e5%8a%a0%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0>添加内核参数</a></h3><p>向 <code>GRUB_CMDLINE_LINUX</code> 中添加 <code>resume</code> 参数，通过 UUID 指定恢复所使用的<em>交换设备</em>，如：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GRUB_CMDLINE_LINUX_DEFAULT=&#34;loglevel=3 nvidia-drm.modeset=1&#34;
</span></span><span style=display:flex><span>GRUB_CMDLINE_LINUX=&#34;noquiet resume=UUID=8759088c-fdb3-4719-952d-a00cd91fa61b&#34;
</span></span></code></pre></td></tr></table></div></div><p>交换分区的 UUID 可以通过 <code>lsblk -f</code> 查看。</p><p>执行以下命令更新 <code>grub.cfg</code> 文件：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></td></tr></table></div></div><h3 class=heading id=其他问题><a href=#%e5%85%b6%e4%bb%96%e9%97%ae%e9%a2%98>其他问题</a></h3><p>如果 swap 分区/文件不够大，或者想提升恢复速度，可以参考 <a href=https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#About_swap_partition/file_size target=_blank rel=external>About swap partition/file size</a>。</p><p>如果没有剩余的空间可作为 swap 分区，可考虑 <a href=https://wiki.archlinux.org/title/Swap#Swap_file target=_blank rel=external>swap 文件</a>。</p><h2 class=heading id=睡眠与键盘及触摸板><a href=#%e7%9d%a1%e7%9c%a0%e4%b8%8e%e9%94%ae%e7%9b%98%e5%8f%8a%e8%a7%a6%e6%91%b8%e6%9d%bf>睡眠与键盘（及触摸板）</a></h2><p>向 <code>GRUB_CMDLINE_LINUX</code> 添加一个或多个以下内核参数可能会有所帮助（添加方法同<a href=#%e6%b7%bb%e5%8a%a0%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0>上</a>）：</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>i8042.noloop i8042.nomux i8042.nopnp i8042.reset
</span></span></code></pre></td></tr></table></div></div><p>关于 <code>i8042.nomux</code> 与 <code>i8042.reset</code> 的说明，可参考 StackExchange 上的<a href=https://unix.stackexchange.com/questions/28736/what-does-the-i8042-nomux-1-kernel-option-do-during-booting-of-ubuntu target=_blank rel=external>这个问题</a>。完整内核参数及说明参考回答中提到的<a href=https://www.kernel.org/doc/Documentation/admin-guide/kernel-parameters.txt target=_blank rel=external>这篇文档</a>。</p></div></div><div class=site-comment><script src=https://giscus.app/client.js data-repo=alohaia/alohaia.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNjgxNjY5NTY=" data-category=Announcements data-category-id=DIC_kwDOFfHILM4B_XeA data-mapping=title data-reactions-enabled=1 data-emit-metadata=1 data-theme=light crossorigin=anonymous async></script></div><div class=site-right><div class=series-container><div class=series-toggle><i class="fas fa-book"></i></div><div id=SeriesList class=series-content><p>Enter any child page of <a href=/series/>Series</a>.</p></div></div></div></div><div id=fastSearch><div class=fast-search-container><div class=fast-search-header><input id=searchInput tabindex=-1 disabled autocomplete=off>
<span class=fast-search-hint id=searchHint>CTRL-/</span></div><ul id=searchResults><div id=searchLoading class=lds-default><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></ul></div></div><script src=/js/fuse.min.js></script><script src=/js/fastsearch.js></script><footer class=site-footer id=SiteFooter><div class=footer-poweredby><span>Powered by <a href=https://gohugo.io target=_blank>Hugo</a></span>
<span class=division>|</span>
<span>Theme - <a href=https://github.com/alohaia/hugo-theme-daisilia target=_blank>Daisilia</a></span></div><div class=footer-copyright>© 2020 - 2023<span class="heart animate__heartBeat animate__infinite"><i class="fas fa-heart"></i></span>
<span><a href=https://daisilia.com target=_blank>Qihuan Liu</a></span></div><div class=footer-creativecommons>本博客所有文章除特别声明外，均采用 <a rel=license href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处。</div></footer><aside class=site-sidebar id=SiteSidebar><div class=sidebar-container><div class=sidebar-nav data-pjax><span role=button class="sidebar-nav-item sidebar-nav-series">Table of Contents</span>
<span role=button class="sidebar-nav-item sidebar-nav-overview">Overview</span></div><div class=sidebar-content><div class="sidebar-toc sidebar-pannel" data-pjax><h1 class=toc-title id=TOCTitle>睡眠、休眠与恢复</h1><nav id=TableOfContents><ul><li><a href=#配置休眠与恢复>配置休眠与恢复</a><ul><li><a href=#配置-initramfs>配置 initramfs</a></li><li><a href=#添加内核参数>添加内核参数</a></li><li><a href=#其他问题>其他问题</a></li></ul></li><li><a href=#睡眠与键盘及触摸板>睡眠与键盘（及触摸板）</a></li></ul></nav></div><div class="sidebar-overview sidebar-pannel"><div class=sidebar-avatar><a href=/about><img class=site-avatar-image alt=Aloha src=/images/avatar.jpg></a></div><p class=site-author-name>Qihuan Liu</p><p class=site-description>欲望要简单，待人要真诚，扮好每个角色</p><div class=sidebar-social><a class=sidebar-social-item href=mailto:liu.qihuan@outlook.com><i class="fas fa-envelope"></i>E-Mail</a><a class=sidebar-social-item href=https://github.com/alohaia target=_blank><i class="fab fa-github"></i>Github</a><a class=sidebar-social-item href=https://space.bilibili.com/437854288 target=_blank><i class="fa-brands fa-bilibili"></i>Bilibili</a></div><div class=site-overview><a class=site-overview-item href=/><p class=site-overview-num>346</p><p class=site-overview-name>Pages</p></a><a class=site-overview-item href=/tags><p class=site-overview-num>216</p><p class=site-overview-name>Tags</p></a><a class=site-overview-item href=/series><p class=site-overview-num>22</p><p class=site-overview-name>Series</p></a></div><div class="sidebar-quote collapsed"><p class=sidebar-quote-content id=SidebarQuoteContent>主人不来过夜半，闲敲棋子落灯花。</p><p class=sidebar-quote-from id=SidebarQuoteFrom>宋代·赵师秀《约客》</p></div><div class=calendar id=Calendar><div class=calendar-header><div class=calendar-header-prev></div><div class=calendar-year-month></div><div class=calendar-header-next></div></div><div class=calendar-body><div class=calendar-week><span>Sun</span>
<span>Mon</span>
<span>Tue</span>
<span>Wed</span>
<span>Thu</span>
<span>Fri</span>
<span>Sat</span></div><div class=calendar-days></div></div></div><div class=sidebar-links><div class=sidebar-links-title><i class="fas fa-user-friends"></i>友链</div><a class=sidebar-links-item href=https://www.sdiopid.top target=_blank><strong>郭老师</strong>的网络自留地</a></div></div></div><div class=back2top id=Back2top role=button><i class="back2top-icon fas fa-angle-double-up"></i>
<span class=back2top-progress id=Back2topProgress></span></div></div><div class=sidebar-toggle id=SidebarToggle role=button><i class="sidebar-toggle-icon right-arrow">&#xf061</i>
<i class="sidebar-toggle-icon bars">&#xf0c9</i>
<i class="sidebar-toggle-icon left-arrow">&#xf060</i></div><div id=SidebarFill></div></aside></div><div class=loading-track><div class=loading-progress></div></div><script src=/js/fancybox.umd.js></script><link rel=stylesheet type=text/css href=/css/fancybox.css><script type=module>
  Fancybox.bind("[data-fancybox]", {
    groupAll: true,
    hideScrollbar: true, 
    caption: function(instance, slide, caption){
      const figcaption = slide.triggerEl?.parentElement.querySelector("figcaption .title");
      return figcaption ? figcaption.innerHTML : slide.caption || "";
    }
  });
</script><script src=/js/daisy.js></script><script data-pjax src=/js/daisy.each.js></script><script src=/js/pjax.js></script><script src=/js/pjax.user.js></script><script src=/js/calendar.js></script><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script><script>var content_part,content_full,is_poem=!0,Result;const wrap=document.getElementsByClassName("sidebar-quote")[0],content=document.getElementById("SidebarQuoteContent"),from=document.getElementById("SidebarQuoteFrom");function toggleFull(){wrap.classList.toggle("expanded"),wrap.classList.toggle("collapsed"),content.innerHTML==content_part?content.innerHTML=content_full:content.innerHTML=content_part}jinrishici.load(function(e){Result=e,content_part=e.data.content,content.innerText=content_part,from.innerHTML=`<span class="author">${e.data.origin.dynasty}·${e.data.origin.author}</span>`+`<span class="title">《${e.data.origin.title}》</span>`;var t="",n=/^(([^，。！？]{5}[，。！？]){2}|([^，。！？]{7}[，。！？]){2})+$/g,s=0;e.data.origin.content.forEach(e=>{e.match(n)?e.match(n)[0].length+1!=s&&s!=0&&(is_poem=!1,s=e.match(n)[0].length+1):is_poem=!1}),is_poem?content.classList.add("poem"):t="&nbsp".repeat(8),content_full=t+e.data.origin.content.join("<br>"+t),content.onclick=toggleFull})</script><div data-pjax></div></body></html>